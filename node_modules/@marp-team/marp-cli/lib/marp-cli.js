"use strict";function _interopDefault(e){return e&&"object"==typeof e&&"default"in e?e.default:e}function _interopNamespace(e){if(e&&e.__esModule)return e;var t={};return e&&Object.keys(e).forEach((function(i){var r=Object.getOwnPropertyDescriptor(e,i);Object.defineProperty(t,i,r.get?r:{enumerable:!0,get:function(){return e[i]}})})),t.default=e,t}Object.defineProperty(exports,"__esModule",{value:!0});var chalk=_interopDefault(require("chalk")),yargs=_interopDefault(require("yargs/yargs")),stripAnsi=_interopDefault(require("strip-ansi")),wrapAnsi=_interopDefault(require("wrap-ansi")),yargs$1=require("yargs"),marpCore=require("@marp-team/marp-core"),cosmiconfig=_interopDefault(require("cosmiconfig")),path=_interopDefault(require("path")),fs=_interopDefault(require("fs")),osLocale=_interopDefault(require("os-locale")),util=require("util"),puppeteer=_interopDefault(require("puppeteer-core")),url$1=require("url"),url$1__default=_interopDefault(url$1),chromeFinder=require("chrome-launcher/dist/chrome-finder"),fileUrl=_interopDefault(require("file-url")),getStdin=_interopDefault(require("get-stdin")),globby=require("globby"),globby__default=_interopDefault(globby),mkdirp=_interopDefault(require("mkdirp")),tmp=require("tmp"),marpit=require("@marp-team/marpit"),chokidar=_interopDefault(require("chokidar")),crypto=_interopDefault(require("crypto")),portfinder=_interopDefault(require("portfinder")),ws=require("ws"),pkgUp=_interopDefault(require("pkg-up")),importFrom=_interopDefault(require("import-from")),os=_interopDefault(require("os")),carlo=_interopDefault(require("carlo")),events=require("events"),express=_interopDefault(require("express")),querystring=_interopDefault(require("querystring")),serveIndex=_interopDefault(require("serve-index"));
/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */
function __awaiter(e,t,i,r){return new(i||(i=Promise))((function(n,o){function s(e){try{p(r.next(e))}catch(e){o(e)}}function a(e){try{p(r.throw(e))}catch(e){o(e)}}function p(e){e.done?n(e.value):new i((function(t){t(e.value)})).then(s,a)}p((r=r.apply(e,t||[])).next())}))}const width=yargs$1.terminalWidth()||80,messageBlock=(e,t,i)=>{const r=stripAnsi(e).length+1;return`${e} ${(i.singleLine?t:wrapAnsi(t,width-r)).split("\n").join(`\n${" ".repeat(r)}`)}`};let silent=!1;function silence(e){silent=e}function info(e,t={}){silent||console.warn(messageBlock(chalk.bgCyan.black("[  INFO ]"),e,t))}function warn(e,t={}){silent||console.warn(messageBlock(chalk.bgYellow.black("[  WARN ]"),e,t))}function error(e,t={}){console.error(messageBlock(chalk.bgRed.white("[ ERROR ]"),e,t))}let cachedPath=!1;function findChrome(){if(!1===cachedPath){const e=(()=>process.env.IS_DOCKER?()=>["/usr/bin/chromium-browser"]:require("is-wsl")?chromeFinder.wsl:chromeFinder[process.platform])();cachedPath=e?e()[0]:void 0}return cachedPath}function metaPlugin({marpit:e}){Object.assign(e.customDirectives.global,{description:e=>"string"==typeof e?{marpCLIDescription:e}:{},image:e=>"string"==typeof e?{marpCLIImage:e}:{},title:e=>"string"==typeof e?{marpCLITitle:e}:{},url:e=>{try{e&&new url$1.URL(e)}catch(t){return warn(`Specified canonical URL is ignored since invalid URL: ${e}`),{}}return{marpCLIURL:e}}})}const engineInfo=Symbol();function infoPlugin(e){const{marpit:t}=e;e.core.ruler.push("marp_cli_info",e=>{if(e.inlineMode)return;const{themeSet:i,lastGlobalDirectives:r}=t,n=r||{},o=n.theme||(i.default||{}).name,s={theme:o,description:n.marpCLIDescription,image:n.marpCLIImage,title:n.marpCLITitle,url:n.marpCLIURL,size:{height:i.getThemeProp(o,"heightPixel"),width:i.getThemeProp(o,"widthPixel")},length:0};for(const t of e.tokens)t.meta&&1===t.meta.marpitSlideElement&&(s.length+=1);t[engineInfo]=s})}class CLIError{constructor(e,t=1){this.name="CLIError",this.message=e,this.errorCode=t}toString(){return this.message}}function error$1(e,t=1){throw new CLIError(e,t)}const stat=util.promisify(fs.stat),mkdirpPromise=util.promisify(mkdirp),readFile=util.promisify(fs.readFile),tmpNamePromise=util.promisify(tmp.tmpName),unlink=util.promisify(fs.unlink),writeFile=util.promisify(fs.writeFile),markdownExtensions=["md","mdown","markdown","markdn"];var FileType;!function(e){e[e.File=0]="File",e[e.StandardIO=1]="StandardIO",e[e.Null=2]="Null"}(FileType||(FileType={}));class File{constructor(e){this.type=FileType.File,this.path=e}get absolutePath(){return path.resolve(this.path)}get absoluteFileScheme(){return url$1.pathToFileURL?url$1.pathToFileURL(this.absolutePath).toString():fileUrl(this.absolutePath)}convert(e,t){switch(e){case void 0:return File.initialize(this.convertName(t),e=>e.type=this.type);case!1:return File.initialize(this.path,e=>e.type=FileType.Null);case"-":return File.initialize("-",e=>e.type=FileType.StandardIO)}return this.inputDir?File.initialize(this.convertName(Object.assign(Object.assign({},t),{basePath:path.join(e,this.relativePath(this.inputDir))}))):File.initialize(this.convertName(Object.assign(Object.assign({},t),{extension:void 0,basePath:e})))}load(){return __awaiter(this,void 0,void 0,(function*(){return this.buffer=this.buffer||(yield readFile(this.path)),this.buffer}))}relativePath(e=process.cwd()){return path.relative(e,this.absolutePath)}save(){return __awaiter(this,void 0,void 0,(function*(){switch(this.type){case FileType.File:yield this.saveToFile();break;case FileType.StandardIO:process.stdout.write(this.buffer)}}))}saveTmpFile(e){return __awaiter(this,void 0,void 0,(function*(){const t=yield tmpNamePromise({postfix:e});return yield this.saveToFile(t),{cleanup:()=>__awaiter(this,void 0,void 0,(function*(){try{yield this.cleanup(t)}catch(e){}})),path:t}}))}cleanup(e){return unlink(e)}convertName(e={}){const{basePath:t,extension:i,page:r}=Object.assign({basePath:this.path},e);let n=t;if(void 0!==i&&(n=path.join(path.dirname(t),`${path.basename(t,path.extname(t))}.${i}`)),void 0!==r){const e=path.extname(n),t=r.toString().padStart(3,"0");n=path.join(path.dirname(n),`${path.basename(n,e)}.${t}${e}`)}return n}saveToFile(e=this.path){return __awaiter(this,void 0,void 0,(function*(){yield mkdirpPromise(path.dirname(path.resolve(e))),yield writeFile(e,this.buffer)}))}static findPath(e,...t){return __awaiter(this,void 0,void 0,(function*(){const i=new Set,r=[];for(const e of t){try{if((yield stat(e)).isFile()){i.add(path.resolve(e));continue}}catch(e){}r.push(e.split(path.sep).join("/"))}return(yield globby__default(r,Object.assign({absolute:!0,ignore:["**/node_modules"]},e))).forEach(e=>i.add(e)),[...i.values()].map(e=>path.normalize(e))}))}static find(...e){return __awaiter(this,void 0,void 0,(function*(){return(yield this.findPath({expandDirectories:{extensions:[],files:markdownExtensions.map(e=>`*.${e}`)}},...e)).map(e=>new File(e))}))}static findDir(e){return __awaiter(this,void 0,void 0,(function*(){const t=yield this.find(e);return t.forEach(t=>t.inputDir=path.resolve(e)),t}))}static stdin(){return __awaiter(this,void 0,void 0,(function*(){if(this.stdinBuffer=this.stdinBuffer||(yield getStdin.buffer()),0!==this.stdinBuffer.length)return this.initialize("-",e=>{e.buffer=this.stdinBuffer,e.type=FileType.StandardIO})}))}static initialize(e,t=(()=>{})){const i=new this(e);return t(i),i}}var pug_has_own_property=Object.prototype.hasOwnProperty,merge=pug_merge;function pug_merge(e,t){if(1===arguments.length){for(var i=e[0],r=1;r<e.length;r++)i=pug_merge(i,e[r]);return i}for(var n in t)if("class"===n){var o=e[n]||[];e[n]=(Array.isArray(o)?o:[o]).concat(t[n]||[])}else if("style"===n){o=(o=pug_style(e[n]))&&";"!==o[o.length-1]?o+";":o;var s=pug_style(t[n]);s=s&&";"!==s[s.length-1]?s+";":s,e[n]=o+s}else e[n]=t[n];return e}var classes=pug_classes;function pug_classes_array(e,t){for(var i,r="",n="",o=Array.isArray(t),s=0;s<e.length;s++)(i=pug_classes(e[s]))&&(o&&t[s]&&(i=pug_escape(i)),r=r+n+i,n=" ");return r}function pug_classes_object(e){var t="",i="";for(var r in e)r&&e[r]&&pug_has_own_property.call(e,r)&&(t=t+i+r,i=" ");return t}function pug_classes(e,t){return Array.isArray(e)?pug_classes_array(e,t):e&&"object"==typeof e?pug_classes_object(e):e||""}var style$1=pug_style;function pug_style(e){if(!e)return"";if("object"==typeof e){var t="";for(var i in e)pug_has_own_property.call(e,i)&&(t=t+i+":"+e[i]+";");return t}return e+""}var attr=pug_attr;function pug_attr(e,t,i,r){if(!1===t||null==t||!t&&("class"===e||"style"===e))return"";if(!0===t)return" "+(r?e:e+'="'+e+'"');var n=typeof t;return"object"!==n&&"function"!==n||"function"!=typeof t.toJSON||(t=t.toJSON()),"string"==typeof t||(t=JSON.stringify(t),i||-1===t.indexOf('"'))?(i&&(t=pug_escape(t))," "+e+'="'+t+'"'):" "+e+"='"+t.replace(/'/g,"&#39;")+"'"}var attrs=pug_attrs;function pug_attrs(e,t){var i="";for(var r in e)if(pug_has_own_property.call(e,r)){var n=e[r];if("class"===r){i=pug_attr(r,n=pug_classes(n),!1,t)+i;continue}"style"===r&&(n=pug_style(n)),i+=pug_attr(r,n,!1,t)}return i}var pug_match_html=/["&<>]/,escape=pug_escape;function pug_escape(e){var t=""+e,i=pug_match_html.exec(t);if(!i)return e;var r,n,o,s="";for(r=i.index,n=0;r<t.length;r++){switch(t.charCodeAt(r)){case 34:o="&quot;";break;case 38:o="&amp;";break;case 60:o="&lt;";break;case 62:o="&gt;";break;default:continue}n!==r&&(s+=t.substring(n,r)),n=r+1,s+=o}return n!==r?s+t.substring(n,r):s}var rethrow=pug_rethrow;function pug_rethrow(e,t,i,r){if(!(e instanceof Error))throw e;if(!("undefined"==typeof window&&t||r))throw e.message+=" on line "+i,e;try{r=r||fs.readFileSync(t,"utf8")}catch(t){pug_rethrow(e,null,i)}var n=3,o=r.split("\n"),s=Math.max(i-n,0),a=Math.min(o.length,i+n);n=o.slice(s,a).map((function(e,t){var r=t+s+1;return(r==i?"  > ":"    ")+r+"| "+e})).join("\n");throw e.path=t,e.message=(t||"Pug")+":"+i+"\n"+n+"\n\n"+e.message,e}var pugRuntime={merge:merge,classes:classes,style:style$1,attr:attr,attrs:attrs,escape:escape,rethrow:rethrow};function barePug(e){var t,i="";try{var r={},n=e||{};(function(e,r,n,o,s,a,p,l,c,d){i=(i+="<!DOCTYPE html>")+"<html"+pugRuntime.attr("lang",p,!0,!0)+">",i+="<head>",r&&(i=i+"<base"+pugRuntime.attr("href",r,!0,!0)+">"),l&&(i=(i=(i+="<title>")+pugRuntime.escape(null==(t=l)?"":t)+"</title>")+'<meta property="og:title"'+pugRuntime.attr("content",l,!0,!0)+">",a&&(i=i+'<meta property="og:image:alt"'+pugRuntime.attr("content",l,!0,!0)+">")),o&&(i=(i=i+'<meta name="description"'+pugRuntime.attr("content",o,!0,!0)+">")+'<meta property="og:description"'+pugRuntime.attr("content",o,!0,!0)+">"),c&&(i=(i=i+'<link rel="canonical"'+pugRuntime.attr("href",c,!0,!0)+">")+'<meta property="og:url"'+pugRuntime.attr("content",c,!0,!0)+">"),a&&(i=i+'<meta property="og:image"'+pugRuntime.attr("content",a,!0,!0)+">"),i+='<meta charset="UTF-8">',i+='<meta name="viewport" content="width=device-width,height=device-height,initial-scale=1.0">',i+='<meta name="apple-mobile-web-app-capable" content="yes">',i+='<meta http-equiv="X-UA-Compatible" content="ie=edge">',i=(i+='<meta property="og:type" content="website">')+'<meta name="twitter:card"'+pugRuntime.attr("content",l&&a?"summary_large_image":"summary",!0,!0)+">",i=(i+='<style media="screen">')+(null==(t=e.css)?"":t)+"</style>",i=(i+="<style>")+(null==(t=n)?"":t)+"</style></head>",i+="<body>",i+=null==(t=s)?"":t,d&&(i=(i+="<script>")+(null==(t=d)?"":t)+"<\/script>"),i+="</body></html>"}).call(this,"bare"in n?n.bare:"undefined"!=typeof bare?bare:void 0,"base"in n?n.base:"undefined"!=typeof base?base:void 0,"css"in n?n.css:"undefined"!=typeof css?css:void 0,"description"in n?n.description:"undefined"!=typeof description?description:void 0,"html"in n?n.html:"undefined"!=typeof html?html:void 0,"image"in n?n.image:"undefined"!=typeof image?image:void 0,"lang"in n?n.lang:"undefined"!=typeof lang?lang:void 0,"title"in n?n.title:"undefined"!=typeof title?title:void 0,"url"in n?n.url:"undefined"!=typeof url?url:void 0,"watchJs"in n?n.watchJs:"undefined"!=typeof watchJs?watchJs:void 0)}catch(e){pugRuntime.rethrow(e,void 0,void 0,r[void 0])}return i}var css$1="body,html{background:#000;height:100%;margin:0;overflow:auto;-ms-scroll-snap-type:y mandatory;scroll-snap-type:y mandatory;-ms-scroll-snap-type:mandatory;scroll-snap-type:mandatory;-ms-scroll-snap-points-y:repeat(100%);scroll-snap-points-y:repeat(100%)}body>svg{display:block;height:100%;scroll-snap-align:center center;width:100%;transform:translateZ(0)}";function bespokePug(e){var t,i="";try{var r={},n=e||{};(function(e,r,n,o,s,a,p,l,c,d){i=(i+="<!DOCTYPE html>")+"<html"+pugRuntime.attr("lang",p,!0,!0)+">",i+="<head>",e&&(i=i+"<base"+pugRuntime.attr("href",e,!0,!0)+">"),l&&(i=(i=(i+="<title>")+pugRuntime.escape(null==(t=l)?"":t)+"</title>")+'<meta property="og:title"'+pugRuntime.attr("content",l,!0,!0)+">",a&&(i=i+'<meta property="og:image:alt"'+pugRuntime.attr("content",l,!0,!0)+">")),o&&(i=(i=i+'<meta name="description"'+pugRuntime.attr("content",o,!0,!0)+">")+'<meta property="og:description"'+pugRuntime.attr("content",o,!0,!0)+">"),c&&(i=(i=i+'<link rel="canonical"'+pugRuntime.attr("href",c,!0,!0)+">")+'<meta property="og:url"'+pugRuntime.attr("content",c,!0,!0)+">"),a&&(i=i+'<meta property="og:image"'+pugRuntime.attr("content",a,!0,!0)+">"),i+='<meta charset="UTF-8">',i+='<meta name="viewport" content="width=device-width,height=device-height,initial-scale=1.0">',i+='<meta name="apple-mobile-web-app-capable" content="yes">',i+='<meta http-equiv="X-UA-Compatible" content="ie=edge">',i=(i+='<meta property="og:type" content="website">')+'<meta name="twitter:card"'+pugRuntime.attr("content",l&&a?"summary_large_image":"summary",!0,!0)+">",i=(i+="<style>")+(null==(t=r.css)?"":t)+"</style>",i=(i+="<style>")+(null==(t=n)?"":t)+"</style></head>",i+="<body>",r.progress&&(i+='<div class="bespoke-progress-parent">',i+='<div class="bespoke-progress-bar"></div></div>'),r.osc&&(i+='<div class="bespoke-marp-osc">',i+='<button data-bespoke-marp-osc="prev" tabindex="-1" title="Previous slide">',i+="Previous slide</button>",i+='<span data-bespoke-marp-osc="page"></span>',i+='<button data-bespoke-marp-osc="next" tabindex="-1" title="Next slide">',i+="Next slide</button>",i+='<button data-bespoke-marp-osc="fullscreen" tabindex="-1" title="Toggle fullscreen (f)">',i+="Toggle fullscreen</button></div>"),i+=null==(t=s)?"":t,i=(i+="<script>")+(null==(t=r.js)?"":t)+"<\/script>",d&&(i=(i+="<script>")+(null==(t=d)?"":t)+"<\/script>"),i+="</body></html>"}).call(this,"base"in n?n.base:"undefined"!=typeof base?base:void 0,"bespoke"in n?n.bespoke:"undefined"!=typeof bespoke?bespoke:void 0,"css"in n?n.css:"undefined"!=typeof css?css:void 0,"description"in n?n.description:"undefined"!=typeof description?description:void 0,"html"in n?n.html:"undefined"!=typeof html?html:void 0,"image"in n?n.image:"undefined"!=typeof image?image:void 0,"lang"in n?n.lang:"undefined"!=typeof lang?lang:void 0,"title"in n?n.title:"undefined"!=typeof title?title:void 0,"url"in n?n.url:"undefined"!=typeof url?url:void 0,"watchJs"in n?n.watchJs:"undefined"!=typeof watchJs?watchJs:void 0)}catch(e){pugRuntime.rethrow(e,void 0,void 0,r[void 0])}return i}var css$2='@media screen{body,html{background:#000;height:100%;margin:0;overflow:hidden}[data-bespoke-marp-fragment=inactive]{visibility:hidden}.bespoke-marp-osc{display:none;opacity:0}.bespoke-marp-parent{bottom:0;left:0;position:absolute;right:0;top:0}.bespoke-marp-parent>.bespoke-marp-osc{background:rgba(0,0,0,.65);border-radius:7px;bottom:50px;color:#fff;display:block;font-family:Helvetica,Arial,sans-serif;font-size:16px;left:50%;line-height:0;opacity:1;padding:12px;position:absolute;touch-action:manipulation;transform:translateX(-50%);transition:opacity .2s linear;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;white-space:nowrap;z-index:1}.bespoke-marp-parent>.bespoke-marp-osc>*{margin-left:6px}.bespoke-marp-parent>.bespoke-marp-osc>:first-child{margin-left:0}.bespoke-marp-parent>.bespoke-marp-osc>span{opacity:.8}.bespoke-marp-parent>.bespoke-marp-osc>span[data-bespoke-marp-osc=page]{display:inline-block;min-width:140px;text-align:center}.bespoke-marp-parent>.bespoke-marp-osc>button{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:0;color:inherit;cursor:pointer;font-size:inherit;opacity:.8;outline:none;padding:0;transition:opacity .2s linear;-webkit-tap-highlight-color:transparent}.bespoke-marp-parent>.bespoke-marp-osc>button:disabled{cursor:not-allowed;opacity:.15!important}.bespoke-marp-parent>.bespoke-marp-osc>button:hover{opacity:1}.bespoke-marp-parent>.bespoke-marp-osc>button:hover:active{opacity:.6}.bespoke-marp-parent>.bespoke-marp-osc>button:hover:not(:disabled){transition:none}.bespoke-marp-parent>.bespoke-marp-osc>button[data-bespoke-marp-osc=prev]{background:transparent url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxMDAgMTAwIj48cGF0aCBmaWxsPSJub25lIiBzdHJva2U9IiNmZmYiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgc3Ryb2tlLXdpZHRoPSI1IiBkPSJNNjggOTBMMjggNTBsNDAtNDAiLz48L3N2Zz4=") no-repeat 50%;background-size:contain;height:32px;overflow:hidden;text-indent:100%;white-space:nowrap;width:32px}.bespoke-marp-parent>.bespoke-marp-osc>button[data-bespoke-marp-osc=next]{background:transparent url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxMDAgMTAwIj48cGF0aCBmaWxsPSJub25lIiBzdHJva2U9IiNmZmYiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgc3Ryb2tlLXdpZHRoPSI1IiBkPSJNMzIgOTBsNDAtNDAtNDAtNDAiLz48L3N2Zz4=") no-repeat 50%;background-size:contain;height:32px;overflow:hidden;text-indent:100%;white-space:nowrap;width:32px}.bespoke-marp-parent>.bespoke-marp-osc>button[data-bespoke-marp-osc=fullscreen]{background:transparent url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxMDAgMTAwIj48ZGVmcz48c3R5bGU+LmF7ZmlsbDpub25lO3N0cm9rZTojZmZmO3N0cm9rZS1saW5lY2FwOnJvdW5kO3N0cm9rZS1saW5lam9pbjpyb3VuZDtzdHJva2Utd2lkdGg6NXB4fTwvc3R5bGU+PC9kZWZzPjxyZWN0IGNsYXNzPSJhIiB4PSIxMCIgeT0iMjAiIHdpZHRoPSI4MCIgaGVpZ2h0PSI2MCIgcng9IjUuNjciLz48cGF0aCBjbGFzcz0iYSIgZD0iTTQwIDcwSDIwVjUwbTIwIDBMMjAgNzBtNDAtNDBoMjB2MjBtLTIwIDBsMjAtMjAiLz48L3N2Zz4=") no-repeat 50%;background-size:contain;height:32px;overflow:hidden;text-indent:100%;white-space:nowrap;width:32px}.bespoke-marp-parent>.bespoke-marp-osc>button[data-bespoke-marp-osc=fullscreen].exit{background-image:url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxMDAgMTAwIj48ZGVmcz48c3R5bGU+LmF7ZmlsbDpub25lO3N0cm9rZTojZmZmO3N0cm9rZS1saW5lY2FwOnJvdW5kO3N0cm9rZS1saW5lam9pbjpyb3VuZDtzdHJva2Utd2lkdGg6NXB4fTwvc3R5bGU+PC9kZWZzPjxyZWN0IGNsYXNzPSJhIiB4PSIxMCIgeT0iMjAiIHdpZHRoPSI4MCIgaGVpZ2h0PSI2MCIgcng9IjUuNjciLz48cGF0aCBjbGFzcz0iYSIgZD0iTTIwIDUwaDIwdjIwbS0yMCAwbDIwLTIwbTQwIDBINjBWMzBtMjAgMEw2MCA1MCIvPjwvc3ZnPg==")}.bespoke-marp-parent.bespoke-marp-inactive{cursor:none}.bespoke-marp-parent.bespoke-marp-inactive>.bespoke-marp-osc{opacity:0;pointer-events:none}svg.bespoke-marp-slide{height:100%;left:0;pointer-events:none;position:absolute;top:0;width:100%;z-index:-1}svg.bespoke-marp-slide.bespoke-marp-active{pointer-events:auto;z-index:0}svg.bespoke-marp-slide[data-bespoke-marp-load=hideable]{display:none}svg.bespoke-marp-slide[data-bespoke-marp-load=hideable].bespoke-marp-active{display:block}.bespoke-progress-parent{background:#222;display:flex;height:5px;width:100%}.bespoke-progress-parent+.bespoke-marp-parent{top:5px}.bespoke-progress-parent .bespoke-progress-bar{flex:0 0 0;background:#0288d1;transition:flex-basis .2s cubic-bezier(0,1,1,1)}}@media print{.bespoke-marp-osc,.bespoke-progress-parent{display:none!important;transition:none!important}.bespoke-marp-parent{top:0}}';const readFile$1=util.promisify(fs.readFile),bare$1=e=>__awaiter(void 0,void 0,void 0,(function*(){const t=e.renderer({container:[],inlineSVG:!0,slideContainer:[]});return{rendered:t,result:barePug(Object.assign(Object.assign(Object.assign({},e),t),{bare:{css:css$1},watchJs:yield watchJs$1(e.notifyWS)}))}})),bespoke$1=e=>__awaiter(void 0,void 0,void 0,(function*(){const t=e.renderer({container:new marpit.Element("div",{id:"p"}),inlineSVG:!0,slideContainer:[]});return{rendered:t,result:bespokePug(Object.assign(Object.assign(Object.assign({},e),t),{bespoke:{css:css$2,js:yield libJs("bespoke.js"),osc:void 0===e.osc||e.osc,progress:e.progress},watchJs:yield watchJs$1(e.notifyWS)}))}}));function libJs(e){return __awaiter(this,void 0,void 0,(function*(){return(yield readFile$1(path.resolve(__dirname,e))).toString()}))}function watchJs$1(e){return __awaiter(this,void 0,void 0,(function*(){if(void 0===e)return!1;const t=yield libJs("watch.js");return`window.__marpCliWatchWS=${JSON.stringify(e)};${t}`}))}var templates={bare:bare$1,bespoke:bespoke$1};class Watcher{constructor(e,t){this.converter=t.converter,this.events=t.events,this.finder=t.finder,this.mode=t.mode,this.chokidar=chokidar.watch(e,{disableGlobbing:!0,ignoreInitial:!0}).on("change",e=>this.convert(e)).on("add",e=>this.convert(e)).on("unlink",e=>this.delete(e)),this.converter.options.themeSet.onThemeUpdated=e=>this.convert(e),notifier.start()}convert(e){return __awaiter(this,void 0,void 0,(function*(){const t=path.resolve(e),i=(yield this.finder()).filter(e=>path.resolve(e.path)===t),r=(yield this.converter.options.themeSet.findPath()).find(e=>path.resolve(e)===t),n=e=>{e.type===FileType.File&&notifier.sendTo(e.absolutePath,"reload")};try{this.mode===Watcher.WatchMode.Convert?yield this.converter.convertFiles(i,{onConverted:e=>{this.events.onConverted(e),n(e.file)}}):this.mode===Watcher.WatchMode.Notify&&i.forEach(n)}catch(e){this.events.onError(e)}void 0!==r&&this.converter.options.themeSet.load(t)}))}delete(e){const t=path.resolve(e),{themeSet:i}=this.converter.options;i.unobserve(t),i.themes.delete(t)}static watch(e,t){return new Watcher(e,t)}}class WatchNotifier{constructor(){this.listeners=new Map}port(){return __awaiter(this,void 0,void 0,(function*(){return void 0===this.portNumber&&(this.portNumber=yield portfinder.getPortPromise({port:37717})),this.portNumber}))}register(e){return __awaiter(this,void 0,void 0,(function*(){const t=WatchNotifier.sha256(e);return this.listeners.has(t)||this.listeners.set(t,new Set),`ws://localhost:${yield this.port()}/${t}`}))}sendTo(e,t){if(!this.wss)return!1;const i=this.listeners.get(WatchNotifier.sha256(e));return!!i&&(i.forEach(e=>e.send(t)),!0)}start(e={}){return __awaiter(this,void 0,void 0,(function*(){this.wss=new ws.Server(Object.assign(Object.assign({},e),{port:yield this.port()})),this.wss.on("connection",(e,t)=>{if(t.url){const[,i]=t.url.split("/"),r=this.listeners.get(i);if(void 0!==r)return this.listeners.set(i,r.add(e)),e.on("close",()=>this.listeners.get(i).delete(e)),void e.send("ready")}e.close()})}))}stop(){void 0!==this.wss&&(this.wss.close(),this.wss=void 0)}static sha256(e){const t=crypto.createHash("sha256");return t.update(e),t.digest("hex").toString()}}const notifier=new WatchNotifier;var ConvertType,watcher=Watcher.watch;!function(e){let t;!function(e){e[e.Convert=0]="Convert",e[e.Notify=1]="Notify"}(t=e.WatchMode||(e.WatchMode={}))}(Watcher||(Watcher={})),function(e){e.html="html",e.pdf="pdf",e.png="png",e.pptx="pptx",e.jpeg="jpg"}(ConvertType||(ConvertType={}));const mimeTypes={[ConvertType.html]:"text/html",[ConvertType.pdf]:"application/pdf",[ConvertType.png]:"image/png",[ConvertType.pptx]:"application/vnd.openxmlformats-officedocument.presentationml.presentation",[ConvertType.jpeg]:"image/jpeg"};class Converter{constructor(e){this.options=e}get template(){const e=templates[this.options.template];return e||error$1(`Template "${this.options.template}" is not found.`),e}convert(e,t){return __awaiter(this,void 0,void 0,(function*(){const{lang:i,globalDirectives:r,type:n}=this.options,o=t&&t.type===FileType.File;let s="";for(const e of Object.keys(r))void 0!==r[e]&&(s+=`\n\x3c!-- ${e}: ${JSON.stringify(r[e])} --\x3e`);return yield this.template(Object.assign(Object.assign({},this.options.templateOption||{}),{lang:i,base:o&&n!==ConvertType.html?t.absoluteFileScheme:void 0,notifyWS:o&&this.options.watch&&n===ConvertType.html?yield notifier.register(t.absolutePath):void 0,renderer:i=>{const r=this.generateEngine(i),n=r.render(`${e}${s}`),a=r[engineInfo];return o&&this.options.themeSet.observe(t.absolutePath,a&&a.theme),Object.assign(Object.assign({},n),a)}}))}))}convertFile(e,t={}){return __awaiter(this,void 0,void 0,(function*(){const i=yield(()=>__awaiter(this,void 0,void 0,(function*(){try{return silence(!!t.onlyScanning),yield this.convert((yield e.load()).toString(),e)}finally{silence(!1)}})))();if(!t.onlyScanning){const r=[];switch(this.options.type){case ConvertType.pdf:r.push(yield this.convertFileToPDF(i,e));break;case ConvertType.png:case ConvertType.jpeg:r.push(...yield this.convertFileToImage(i,e,{pages:this.options.pages,quality:this.options.jpegQuality,type:this.options.type}));break;case ConvertType.pptx:r.push(yield this.convertFileToPPTX(i,e));break;default:r.push(this.convertFileToHTML(i,e))}for(const n of r)yield n.save(),t.onConverted&&t.onConverted({file:e,newFile:n,template:i});return{file:e,template:i,newFile:r[0]}}return{file:e,template:i}}))}convertFiles(e,t={}){return __awaiter(this,void 0,void 0,(function*(){const{inputDir:i,output:r}=this.options;!i&&r&&"-"!==r&&e.length>1&&error$1("Output path cannot specify with processing multiple files.");for(const i of e)yield this.convertFile(i,t)}))}convertFileToHTML(e,t){const i=t.convert(this.options.output,{extension:"html"});return i.buffer=Buffer.from(e.result),i}convertFileToPDF(e,t){return __awaiter(this,void 0,void 0,(function*(){const i=new File(t.absolutePath);i.buffer=Buffer.from(e.result);const r=t.convert(this.options.output,{extension:"pdf"});return r.buffer=yield this.usePuppeteer(i,(e,t)=>__awaiter(this,void 0,void 0,(function*(){return yield e.goto(t,{waitUntil:["domcontentloaded","networkidle0"]}),yield e.pdf({printBackground:!0,preferCSSPageSize:!0})}))),r}))}convertFileToImage(e,t,i){return __awaiter(this,void 0,void 0,(function*(){const r=new File(t.absolutePath);r.buffer=Buffer.from(e.result);const n=[];return yield this.usePuppeteer(r,(r,o)=>__awaiter(this,void 0,void 0,(function*(){yield r.setViewport(e.rendered.size),yield r.goto(o,{waitUntil:["domcontentloaded","networkidle0"]}),yield r.emulateMedia("print");const s=t=>__awaiter(this,void 0,void 0,(function*(){return yield r.evaluate(`window.scrollTo(0,${((t||1)-1)*e.rendered.size.height})`),i.type===ConvertType.jpeg?yield r.screenshot({quality:i.quality,type:"jpeg"}):yield r.screenshot({type:"png"})}));if(i.pages)for(let r=1;r<=e.rendered.length;r+=1){const e=t.convert(this.options.output,{page:r,extension:i.type});e.buffer=yield s(r),n.push(e)}else{const e=t.convert(this.options.output,{extension:i.type});e.buffer=yield s(),n.push(e)}}))),n}))}convertFileToPPTX(e,t){return __awaiter(this,void 0,void 0,(function*(){const i=yield this.convertFileToImage(e,t,{pages:!0,type:ConvertType.png}),r=new((yield new Promise((function(e){e(_interopNamespace(require("@marp-team/pptx")))}))).default),n=`${e.rendered.size.width}x${e.rendered.size.height}`;r.setAuthor("Created by Marp"),r.setCompany("Created by Marp"),r.setLayout({name:n,width:e.rendered.size.width/96,height:e.rendered.size.height/96}),e.rendered.title&&r.setTitle(e.rendered.title),e.rendered.description&&r.setSubject(e.rendered.description);let o=0;for(const t of i){o+=1,r.defineSlideMaster({title:`Page ${o}`,bkgd:{data:`data:image/png;base64,${t.buffer.toString("base64")}`},margin:0});const i=r.addNewSlide(`Page ${o}`),n=e.rendered.comments[o-1].join("\n\n");n&&i.addNotes(n)}const s=t.convert(this.options.output,{extension:"pptx"});return s.buffer=yield new Promise(e=>r.save("jszip",e,"nodebuffer")),s}))}generateEngine(e){const{html:t,options:i}=this.options,{prototype:r}=this.options.engine,n=Object.assign(Object.assign(Object.assign({},i),e),{html:t}),o=r&&r.hasOwnProperty("constructor")?new this.options.engine(n):this.options.engine(n);return"function"!=typeof o.render&&error$1("Specified engine has not implemented render() method."),void 0!==t&&o.markdown.set({html:t}),o.use(metaPlugin).use(infoPlugin),this.options.themeSet.registerTo(o),o}usePuppeteer(e,t){return __awaiter(this,void 0,void 0,(function*(){const i=yield(()=>{if(this.options.allowLocalFiles)return warn(`Insecure local file accessing is enabled for conversion from ${e.relativePath()}.`),e.saveTmpFile(".html")})(),r=i?`file://${i.path}`:`data:text/html;base64,${e.buffer.toString("base64")}`;try{const e=yield Converter.runBrowser(),n=yield e.newPage(),o=this.trackFailedLocalFileAccess(n);try{return yield t(n,r)}finally{o.size>0&&warn(`Marp CLI has detected accessing to local file${o.size>1?"s":""}. ${o.size>1?"They are":"That is"} blocked by security reason. Instead we recommend using assets uploaded to online. (Or you can use ${chalk.yellow("--allow-local-files")} option if you are understood of security risk)`),yield n.close()}}finally{i&&(yield i.cleanup())}}))}trackFailedLocalFileAccess(e){const t=new Set;return e.on("requestfailed",e=>{try{const i=new url$1.URL(e.url());"file:"===i.protocol&&t.add(i.href)}catch(e){}}),t}static closeBrowser(){return __awaiter(this,void 0,void 0,(function*(){Converter.browser&&(yield Converter.browser.close())}))}static runBrowser(){return __awaiter(this,void 0,void 0,(function*(){if(!Converter.browser){const e=[];process.env.IS_DOCKER&&e.push("--no-sandbox"),(process.env.IS_DOCKER||process.env.CI)&&e.push("--disable-features=VizDisplayCompositor"),Converter.browser=yield puppeteer.launch({args:e,executablePath:findChrome()}),Converter.browser.once("disconnected",()=>{Converter.browser=void 0})}return Converter.browser}))}}class ResolvedEngine{constructor(e){this.klass=e}static resolve(e,t){return __awaiter(this,void 0,void 0,(function*(){const i=new ResolvedEngine(ResolvedEngine.resolveModule(e,t));return yield i.resolvePackage(),i}))}static resolveModule(e,t){let i;if((Array.isArray(e)?e:[e]).some(e=>("string"==typeof e?(i=t&&importFrom.silent(path.dirname(path.resolve(t)),e)||importFrom.silent(process.cwd(),e))&&i.__esModule&&(i=i.default):i=e,i)),!i)throw new CLIError("The specified engine has not resolved.");return i}resolvePackage(){return __awaiter(this,void 0,void 0,(function*(){const e=this.findClassPath(this.klass);if(!e)return;const t=yield pkgUp({cwd:path.dirname(e)});t&&(this.package=require(t))}))}findClassPath(e){for(const t in require.cache){const i=require.cache[t].exports;if(i===e||i&&i.__esModule&&Object.values(i).includes(e))return t}}}var resolveEngine=ResolvedEngine.resolve;const lstat=util.promisify(fs.lstat),readFile$2=util.promisify(fs.readFile);class Theme{constructor(e,t){this.filename=e,this.overrideName=!0===t.overrideName?this.genUniqName():t.overrideName,this.name=this.overrideName}get buffer(){return this.readBuffer}get css(){const e=this.buffer.toString();return this.overrideName?`${e}\n/* @theme ${this.overrideName} */`:e}load(){return __awaiter(this,void 0,void 0,(function*(){this.readBuffer=yield readFile$2(this.filename)}))}genUniqName(){const e=()=>Math.random().toString(36).slice(2);return`${e()}${e()}${e()}${e()}`}static initialize(e,t={}){return __awaiter(this,void 0,void 0,(function*(){const i=new Theme(e,t);return yield i.load(),i}))}}class ThemeSet{constructor(e){this.themes=new Map,this.onThemeUpdated=()=>{},this.observedMarkdowns=new Map,this.fn=e.fn,this.fnForWatch=e.fnForWatch}findPath(){return __awaiter(this,void 0,void 0,(function*(){return yield ThemeSet.findPath(this.fn)}))}load(e){return __awaiter(this,void 0,void 0,(function*(){const t=path.resolve(e);let i=this.themes.get(t);i?yield i.load():(i=yield Theme.initialize(t),this.add(i)),void 0!==i.name&&this.notify(i.name)}))}observe(e,t){this.observedMarkdowns.set(e,t)}registerTo(e){for(const t of this.themes.values())try{const i=e.themeSet.add(t.css);t.name=i.name}catch(e){warn(`Cannot register theme CSS: ${path.relative(process.cwd(),t.filename)} (${e.message})`)}}unobserve(e){this.observedMarkdowns.delete(e)}add(e){this.themes.set(e.filename,e)}notify(e){this.observedMarkdowns.forEach((t,i)=>{t===e&&this.onThemeUpdated(i)})}static initialize(e,t=[]){return __awaiter(this,void 0,void 0,(function*(){const i=[...e,...t.map(e=>e.filename)],r=yield ThemeSet.findPath(i),n=new Set(r.map(e=>path.resolve(e)));for(const e of i)if(!globby.hasMagic(e))try{const t=yield lstat(e);(t.isFile()||t.isDirectory()||t.isSymbolicLink())&&n.add(path.resolve(e))}catch(e){}const o=new ThemeSet({fn:i,fnForWatch:[...n]});for(const e of r)yield o.load(e);return t.forEach(e=>o.add(e)),o}))}static findPath(e){return __awaiter(this,void 0,void 0,(function*(){return File.findPath({expandDirectories:{extensions:[],files:["*.css"]}},...e)}))}}const lstat$1=util.promisify(fs.lstat),pick=(...e)=>e.find(e=>void 0!==e);class MarpCLIConfig{constructor(){this.args={},this.conf={}}static fromArguments(e){return __awaiter(this,void 0,void 0,(function*(){const t=new MarpCLIConfig;return t.args=e,yield t.loadConf(e.configFile),t.engine=yield(()=>t.args.engine?resolveEngine(t.args.engine):t.conf.engine?resolveEngine(t.conf.engine,t.confPath):resolveEngine(["@marp-team/marp-core",marpCore.Marp]))(),t}))}converterOption(){return __awaiter(this,void 0,void 0,(function*(){const e=yield this.inputDir(),t=pick(this.args.server,this.conf.server)||!1,i=(()=>!t&&(void 0!==this.args.output?this.args.output:void 0!==this.conf.output?"-"===this.conf.output||!1===this.conf.output?this.conf.output:path.resolve(path.dirname(this.confPath),this.conf.output):void 0))(),r=this.args.template||this.conf.template||"bespoke",n=(()=>{if("bespoke"===r){const e=this.conf.bespoke||{};return{osc:pick(this.args.bespoke&&this.args.bespoke.osc,this.args.bespokeOsc,e.osc),progress:pick(this.args.bespoke&&this.args.bespoke.progress,this.args.bespokeProgress,e.progress)}}return{}})(),o=yield this.loadTheme(),s=o instanceof Theme?[o]:[],a=this.args.themeSet||(this.conf.themeSet?(Array.isArray(this.conf.themeSet)?this.conf.themeSet:[this.conf.themeSet]).map(e=>path.resolve(path.dirname(this.confPath),e)):[]),p=yield ThemeSet.initialize((e?[e]:[]).concat(a),s);p.themes.size<=s.length&&a.length>0&&warn("Not found additional theme CSS files.");const l=(()=>{if(this.args.pdf||this.conf.pdf)return ConvertType.pdf;if(this.args.pptx||this.conf.pptx)return ConvertType.pptx;const e=this.args.images||this.conf.images||this.args.image||this.conf.image;if("png"===e)return ConvertType.png;if("jpeg"===e)return ConvertType.jpeg;const t=(i||"").toLowerCase();return t.endsWith(".pdf")?ConvertType.pdf:t.endsWith(".png")?ConvertType.png:t.endsWith(".pptx")?ConvertType.pptx:t.endsWith(".jpg")||t.endsWith(".jpeg")?ConvertType.jpeg:ConvertType.html})(),c=(()=>{const e=pick(this.args.preview,this.conf.preview)||!1;return e&&process.env.IS_DOCKER?(warn("Preview window cannot show in an official docker image. Preview option was ignored."),!1):e})();return{inputDir:e,output:i,preview:c,server:t,template:r,templateOption:n,themeSet:p,type:l,allowLocalFiles:pick(this.args.allowLocalFiles,this.conf.allowLocalFiles)||!1,engine:this.engine.klass,globalDirectives:{description:pick(this.args.description,this.conf.description),image:pick(this.args.ogImage,this.conf.ogImage),theme:o instanceof Theme?o.name:o,title:pick(this.args.title,this.conf.title),url:pick(this.args.url,this.conf.url)},html:pick(this.args.html,this.conf.html),jpegQuality:pick(this.args.jpegQuality,this.conf.jpegQuality)||85,lang:this.conf.lang||(yield osLocale()).replace(/@/g,"-"),options:this.conf.options||{},pages:!(!this.args.images&&!this.conf.images),watch:pick(this.args.watch,this.conf.watch)||c||t||!1}}))}get files(){return this.args.server||this.conf.server?[]:this.args._||[]}inputDir(){return __awaiter(this,void 0,void 0,(function*(){const e=(()=>{if(this.args.inputDir)return path.resolve(this.args.inputDir);if(this.conf.inputDir)return path.resolve(path.dirname(this.confPath),this.conf.inputDir);if((this.args.server||this.conf.server)&&Array.isArray(this.args._)){if(this.args._.length>1)throw new CLIError("Server mode have to specify just one directory.");if(1===this.args._.length)return path.resolve(this.args._[0])}})();if(void 0===e)return;let t;try{t=yield lstat$1(e)}catch(t){if("ENOENT"!==t.code)throw t;throw new CLIError(`Input directory "${e}" is not found.`)}if(!t.isDirectory())throw new CLIError(`"${e}" is not directory.`);return e}))}loadConf(e){return __awaiter(this,void 0,void 0,(function*(){const t=cosmiconfig(MarpCLIConfig.moduleName);try{const i=yield void 0===e?t.search():t.load(e);i&&(this.confPath=i.filepath,this.conf=i.config)}catch(t){throw new CLIError(["Could not find or parse configuration file.","Error"!==t.name&&`(${t.name})`,void 0!==e&&`[${e}]`].filter(e=>e).join(" "))}}))}loadTheme(){return __awaiter(this,void 0,void 0,(function*(){const e=(()=>this.args.theme?{advice:{use:"--theme-set",insteadOf:"--theme"},name:this.args.theme,path:path.resolve(this.args.theme)}:this.conf.theme?{advice:{use:"themeSet",insteadOf:"theme"},name:this.conf.theme,path:path.resolve(path.dirname(this.confPath),this.conf.theme)}:void 0)();if(e){try{return yield Theme.initialize(e.path,{overrideName:!0})}catch(t){if("EISDIR"===t.code)throw info(`Please use ${chalk.yellow(e.advice.use)} option instead of ${e.advice.insteadOf} to make theme CSS available from directory.`),new CLIError(`Directory cannot pass to theme option. (${e.path})`);if("ENOENT"!==t.code)throw t}return e.name}}))}}MarpCLIConfig.moduleName="marp";var fromArguments=MarpCLIConfig.fromArguments;class TypedEventEmitter extends events.EventEmitter{}var favicon$1="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAfQAAAH0AgMAAAC2uDcZAAAADFBMVEUAAAABiNJnueQBZp1z8GXRAAAAA3RSTlMA/f4BYYQ1AAAFJUlEQVR42u3cuXGeMQyEYZrjwKFLcCluQv24Hlfp4L++kySwCyDwbkzyHekZXYla0zRN0zRN0zRN0zRN0zRN0zRN0zRN0zRN0zRN0zRN0zRNw/fNcrh3cv275fAPdv2n5fAv9mf+y3L4b69kb72SnV03spPrvy2H/5DrRnZy3chOrlu/2nslO7duZefWrezcuvmbfK9kp9bN7NS6mZ1at/9s75XszLqdnVm3szPrjl/peiU7se5gJ9Yd7MS65zf5XsnOq3vYeXUPO6/u+gOuV7LT6i52Wt3FTqv7/m7vleysuo+dVfexs+o+dlbdx06qO9lJdSc7qe5kJ9Wd7Jy6l51T97Jz6l52Tt3LTqm72Sl1Nzul7man1N3sjLqfnVH3szPqfnZG3c9OqAPshDrATqgD7IQ6wI7XEXa8jrDjdYQdryPscB1ih+sQO1yH2OE6xI7WMXa0jrGjdYwdrWPsYB1kB+sgO1gH2cE6yI7VUXasjrJjdZQdq6PsUB1mh+owO1SH2aE6zI7UcXakjrMjdZwdqePsQJ3ADtQJ7ECdwA7UCez+OoPdX2ew++sMdn+dwe6uU9jddQq7u05hd9cp7N46h91b57B76xx2b53D7qyT2J11EruzTmJ31knsvjqL3VdnsfvqLHZfncXuqtPYXXUau6tOY3fVaeyeOo/dU+exe+o8dk+dx+6oE9kddSK7o05kd9SJ7PY6k91eZ7Lb60x2e53Jbq5T2c11Kru5TmU316ns1jqX3VrnslvrXHZrncturJPZjXUyu7FOZjfWyey2OpvdVmez2+psdludzW6q09lNdTq7qU5nN9Xp7JY6n91S57Nb6nx2S53PbqgHsBvqAeyGegC7oR7Avl6PYF+vR7Cv1yPY1+sR7Mv1EPblgyHsy/UQ9uV6CPtqPYZ99WQM+2o9hn21HsO+WA9iXzwaxL5YD2JfrAexr9Wj2NfORrGv1aPY1+pR7Ev1MPalw2HsS/Uw9qXPqul/zn6RP/Y49pXTcewr9Tj2lXrYV/tKPZB94Xgg+0I9kH2hHsg+r0eyz89Hss/rkezzeiT7tB7KPr0Qyj6th7JP66Hss3os++xGLPusHss+q8eyT+rB7JMrweyTejD7pB7MPq5Hs4/vRLOP69Hs43o0+7Aezj68FM4+rIezD+vh7KN6PPvoVjz7qB7PPqrHsw/qCeyDawnsg3oC+6CewH5fz2C/v5fBfl/PYL+vZ7Df1lPYby+msN/WU9hv6ynsd/Uc9rubOex39Rz2u3oO+009if3mahL7TT2J/aaexH5dz2K/vpvFfl3PYr+uZ7Ff1tPYLy+nsV/W09gv62nsV/U89qvbeexX9Tz2q3oe+0U9kf3ieiL7RT2R/aKeyH6uZ7Kf72eyn+uZ7Od6Jvupnsp+eiCV/VRPZT/VU9mP9Vz24wu57Md6Lvuxnst+qCezH55IZj/Uk9kP9WT2fT2bff9GNvu+ns2+r2ez7+rp7LtH0tl39XT2XT2dfVvPZ9++ks++reezb+v57Jt6AfvmmQL2Tb2AfVMvYP/UK9g/71Swf+oV7J96Bfu7XsL+fqiE/V0vYX/XS9hf9Rr210s17K96DfurXsP+rBexP58qYn/Wi9if9SL2R72K/fFWFfujXsX+qFext17J3nole+uV7K1Xsrdeyd56JXvrleytV7K3XsneeiV765XsrVeyt17J3nole+uV7K1Xsmuapmmapmmapmmapmmapmmapmmapmmapmmapmmapmma9p/uH/kiUlWp8dyDAAAAAElFTkSuQmCC";class Preview extends TypedEventEmitter{constructor(e={}){super(),this.options={height:e.height||360,width:e.width||640}}get carlo(){return this.carloInternal}open(e){return __awaiter(this,void 0,void 0,(function*(){this.emit("opening",e);const t=(yield this.createWindow())||(yield this.launch());t.on("close",()=>this.emit("close",t)),yield t.load(e),this.emit("open",t,e);const{close:i}=t;return t.close=()=>__awaiter(this,void 0,void 0,(function*(){try{return yield i.call(t)}catch(e){if(!e.message.includes("Target closed."))throw e}})),t}))}createWindow(){return __awaiter(this,void 0,void 0,(function*(){return!!this.carlo&&(yield this.carlo.createWindow({height:this.options.height,width:this.options.width}))}))}launch(){return __awaiter(this,void 0,void 0,(function*(){return this.carloInternal=yield carlo.launch({localDataDir:path.resolve(os.tmpdir(),"./marp-cli-carlo"),args:["--disable-features=TranslateUI"],height:this.options.height,width:this.options.width,executablePath:findChrome(),icon:Buffer.from(favicon$1.slice(22),"base64"),title:"Marp CLI"}),this.carlo.once("exit",()=>{this.emit("exit"),this.carloInternal=void 0}),this.emit("launch"),yield this.carlo.mainWindow()}))}}function fileToURI(e,t){if(e.type===FileType.File){const t=e.absolutePath.replace(/\\/g,"/");return encodeURI(`file://${t.startsWith("/")?"":"/"}${t}`)}if(e.buffer)return`data:${mimeTypes[t]};base64,${e.buffer.toString("base64")}`;throw new CLIError("Processing file is not convertible to URI for preview.")}function serverIndex(e){var t,i="";try{var r={},n=e||{};(function(e,r,n,o,s,a){i+="<!DOCTYPE html>",i+="<html>",i+="<head>",i+='<meta charset="UTF-8">',i+='<meta name="google" content="notranslate">',i+='<meta name="viewport" content="width=device-width initial-scale=1.0">',i=(i+='<meta http-equiv="X-UA-Compatible" content="ie=edge">')+'<link rel="icon" type="image/png"'+pugRuntime.attr("href",n,!0,!0)+">",i=(i+="<style>")+(null==(t=a)?"":t)+"</style></head>",i+="<body>",i=(i+="<h1>")+pugRuntime.escape(null==(t=e)?"":t)+"</h1>",i+='<label id="show-all-container">',i+='<input class="toggle" id="show-all" type="checkbox">',i+="",i+="\n",i+="Show all files and directories</label>",i+='<ul id="index">',function(){var e=o;if("number"==typeof e.length)for(var n=0,s=e.length;n<s;n++){var a=e[n];i=(i=(i=i+"<li"+pugRuntime.attr("class",pugRuntime.classes([{convertible:a.convertible,directory:a.directory,nodeModules:a.nodeModules}],[!0]),!1,!0)+">")+'<a class="link file"'+pugRuntime.attr("href",r(a.name),!0,!0)+">")+pugRuntime.escape(null==(t=a.name)?"":t)+"</a>",a.convertible&&(i=i+'<a class="link pdf"'+pugRuntime.attr("href",`${r(a.name)}?pdf`,!0,!0)+">",i=(i+="PDF</a>")+'<a class="link pptx"'+pugRuntime.attr("href",`${r(a.name)}?pptx`,!0,!0)+">",i+="PPTX</a>"),i+="</li>"}else{s=0;for(var n in e){s++;a=e[n];i=(i=(i=i+"<li"+pugRuntime.attr("class",pugRuntime.classes([{convertible:a.convertible,directory:a.directory,nodeModules:a.nodeModules}],[!0]),!1,!0)+">")+'<a class="link file"'+pugRuntime.attr("href",r(a.name),!0,!0)+">")+pugRuntime.escape(null==(t=a.name)?"":t)+"</a>",a.convertible&&(i=i+'<a class="link pdf"'+pugRuntime.attr("href",`${r(a.name)}?pdf`,!0,!0)+">",i=(i+="PDF</a>")+'<a class="link pptx"'+pugRuntime.attr("href",`${r(a.name)}?pptx`,!0,!0)+">",i+="PPTX</a>"),i+="</li>"}}}.call(this),i+="</ul>",i=(i+="<script>")+(null==(t=s)?"":t)+"<\/script></body></html>"}).call(this,"directory"in n?n.directory:"undefined"!=typeof directory?directory:void 0,"encodeURIComponent"in n?n.encodeURIComponent:"undefined"!=typeof encodeURIComponent?encodeURIComponent:void 0,"favicon"in n?n.favicon:"undefined"!=typeof favicon?favicon:void 0,"files"in n?n.files:"undefined"!=typeof files?files:void 0,"script"in n?n.script:"undefined"!=typeof script?script:void 0,"style"in n?n.style:"undefined"!=typeof style?style:void 0)}catch(e){pugRuntime.rethrow(e,void 0,void 0,r[void 0])}return i}var css$3='body{background:#fff;color:#444;font-size:15px}h1{font-size:26px}ul#index{list-style:none;margin:1em 2em;max-width:720px;padding:0}ul#index li{background-image:url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxMDAgMTAwIj48cGF0aCBkPSJNNzAgMzBMNTMuNTQgMTMuNTRDNTEuNTkgMTEuNTkgNTAgMTIuMjUgNTAgMTV2MjBhNSA1IDAgMDA1IDVoMjBhNSA1IDAgMDE1IDV2NDBhNSA1IDAgMDEtNSA1SDI1YTUgNSAwIDAxLTUtNVYxNWE1IDUgMCAwMTUtNWgxNSIgZmlsbD0ibm9uZSIgc3Ryb2tlPSIjNjY2IiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIHN0cm9rZS13aWR0aD0iNSIvPjwvc3ZnPg==");background-size:24px 24px;background-repeat:no-repeat;background-position:0;display:flex;height:30px;margin:5px 0 0;opacity:.5;padding:0 0 0 calc(24px + .5em)}ul#index li.convertible{background-image:url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxMDAgMTAwIj48ZGVmcz48c3R5bGU+Lmx7ZmlsbDpub25lO3N0cm9rZTojMDI4OGQxO3N0cm9rZS1saW5lY2FwOnJvdW5kO3N0cm9rZS1saW5lam9pbjpyb3VuZDtzdHJva2Utd2lkdGg6NXB4fTwvc3R5bGU+PC9kZWZzPjxwYXRoIGNsYXNzPSJsIiBkPSJNMzYuNzEgNzYuNzlsNTMuNTctNTMuNTh2NTMuNThIMzYuNzF6Ii8+PHBhdGggY2xhc3M9ImwiIGQ9Ik0xMCA3Ni43OWw1My41Ny01My41OHY1My41OEgxMHoiLz48L3N2Zz4=");opacity:1}ul#index li.directory{background-image:url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxMDAgMTAwIj48cGF0aCBkPSJNODIgMzBINTdhMTMuOTEgMTMuOTEgMCAwMS04LjU0LTMuNTRsLTIuOTItMi45MkExMy45MSAxMy45MSAwIDAwMzcgMjBIMTdhNSA1IDAgMDAtNSA1djUwYzAgMi43NS41NSAyLjgyIDEuMjEuMTVsNy41OC0zMC4zQTYuNzQgNi43NCAwIDAxMjcgNDBoNjBhMy43MyAzLjczIDAgMDEzLjc5IDQuODVsLTcuNTggMzAuM0E2Ljc0IDYuNzQgMCAwMTc3IDgwSDIyIiBmaWxsPSJub25lIiBzdHJva2U9IiM2NjYiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgc3Ryb2tlLXdpZHRoPSI1Ii8+PC9zdmc+")}ul#index li.directory:not(.nodeModules){opacity:1}ul#index li a.link{border-radius:5px;box-sizing:border-box;color:#02669d;display:block;height:30px;line-height:20px;padding:5px 10px;text-decoration:none}ul#index li a.link:focus,ul#index li a.link:hover{background:#f8f8f8;text-decoration:underline}ul#index li a.link:hover:active{background:#f0f0f0}ul#index li a.link.file{flex:1;overflow:hidden;white-space:nowrap;text-overflow:ellipsis}ul#index li a.link.pdf,ul#index li a.link.pptx{flex:0 1 auto;font-size:14px;margin:0 0 0 .5em}ul#index li a.link.pdf{color:#ee1d1f}ul#index li a.link.pptx{color:#b7472a}ul#index:not(.show-all) li.nodeModules,ul#index:not(.show-all) li:not(.convertible):not(.directory){display:none}#show-all-container{cursor:pointer;display:block;font-size:.85em;margin:1em 2em;max-width:720px;text-align:right}input.toggle[type=checkbox]{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:#666;border-radius:16px;cursor:pointer;display:inline-block;height:16px;margin:0;outline:0;position:relative;transition:background-color .2s ease-out;vertical-align:middle;width:32px}input.toggle[type=checkbox]:before{border-radius:20px;border:1px solid transparent;bottom:-2px;box-sizing:border-box;content:"";display:block;left:-2px;opacity:.75;position:absolute;right:-2px;top:-2px;transition:border-color .2s ease-out}input.toggle[type=checkbox]:after{background:#fff;border-radius:12px;content:"";display:inline-block;height:12px;left:2px;margin:0 auto 0 0;position:absolute;top:2px;transition:left .2s ease-out;width:12px}input.toggle[type=checkbox]:focus:before{border-color:#555}input.toggle[type=checkbox]:checked{background-color:#6c6}input.toggle[type=checkbox]:checked:focus:before{border-color:#6c6}input.toggle[type=checkbox]:checked:after{left:calc(100% - 14px)}input.toggle[type=checkbox]:hover:active{background-color:#555;transition:none}input.toggle[type=checkbox]:hover:active:checked{background-color:#5b5}';const stat$1=util.promisify(fs.stat),readFile$3=util.promisify(fs.readFile);class Server extends TypedEventEmitter{constructor(e,t={}){super(),e.options.inputDir||error$1("Converter have to specify an input directory."),this.converter=e,this.directoryIndex=t.directoryIndex||[],this.inputDir=e.options.inputDir,this.options=t,this.port=Number.parseInt(process.env.PORT,10)||8080}start(){return __awaiter(this,void 0,void 0,(function*(){return this.setup(),new Promise((e,t)=>{const i=this.server.listen(this.port);i.on("listening",()=>{e()}),i.on("error",e=>{i.close(),"EADDRINUSE"===e.code?t(new CLIError(e.message)):t(e)})})}))}convertMarkdown(e,t={}){return __awaiter(this,void 0,void 0,(function*(){this.converter.options.output=!1,this.converter.options.pages=!1,this.converter.options.type=(()=>{const e=Object.keys(t);return e.includes("pdf")?ConvertType.pdf:e.includes("pptx")?ConvertType.pptx:e.includes("png")?ConvertType.png:e.includes("jpg")||e.includes("jpeg")?ConvertType.jpeg:ConvertType.html})();const i=yield this.converter.convertFile(new File(e));return this.emit("converted",i),i}))}loadScript(){return __awaiter(this,void 0,void 0,(function*(){return void 0===Server.script&&(Server.script=(yield readFile$3(path.resolve(__dirname,"./server/server-index.js"))).toString()),Server.script}))}preprocess(e,t){return __awaiter(this,void 0,void 0,(function*(){const{pathname:i,query:r}=url$1__default.parse(e.url);if(!i)return;const n=querystring.parse(r||""),o=e=>__awaiter(this,void 0,void 0,(function*(){try{const i=yield this.convertMarkdown(e,n);if(!i.newFile)throw new Error("Converter must return a converted file to serve.");const{type:r}=this.converter.options;r===ConvertType.pptx&&t.attachment(`${path.basename(e,path.extname(e))}.pptx`),t.type(mimeTypes[r]).end(i.newFile.buffer)}catch(e){this.emit("error",e),t.status(503).end(e.toString())}})),s=yield this.validateMarkdown(i);if(s.valid)yield o(s.path);else if(s.stats&&s.stats.isDirectory())for(const e of this.directoryIndex){const t=yield this.validateMarkdown(path.join(path.relative(this.inputDir,s.path),e));if(t.valid){yield o(t.path);break}}}))}setup(){this.server=express(),this.server.get("*",(e,t,i)=>this.preprocess(e,t).then(()=>{t.finished||i()})).use(express.static(this.inputDir)).use(serveIndex(this.inputDir,{template:this.template.bind(this)}))}template(e,t){const{directory:i,path:r,fileList:n}=e,o=[];(()=>__awaiter(this,void 0,void 0,(function*(){const e=yield this.loadScript();for(const e of n){const{name:t,stat:i}=e,r=i&&i.isDirectory(),n=".."===t&&r,s="node_modules"===t&&r,a=!n&&(yield this.validateMarkdown(t,i)).valid;o.push({convertible:a,directory:r,name:t,nodeModules:s,parent:n,stat:i})}t(null,serverIndex({directory:i,favicon:favicon$1,files:o,path:r,script:e,style:css$3}))})))()}validateMarkdown(e,t){return __awaiter(this,void 0,void 0,(function*(){const i=path.extname(e).slice(1);let r=markdownExtensions.includes(i);const n=path.resolve(this.inputDir),o=path.join(n,decodeURIComponent(e));if(!o.startsWith(n))return{valid:!1,path:o};let s;try{s=t||(yield stat$1(o)),r=r&&!(!s||!s.isFile())}catch(e){r=!1}return{valid:r,stats:s,path:o}}))}}const version="0.14.0",name="@marp-team/marp-cli",version$1="0.15.0",isMarpCore=e=>e===marpCore.Marp;function outputVersion(e){return __awaiter(this,void 0,void 0,(function*(){let t="";const{engine:i}=e;return isMarpCore(i.klass)?(t=`@marp-team/marp-core v${version}`,i.package&&i.package.version!==version&&(t=`user-installed @marp-team/marp-core v${i.package.version}`)):t=i.package&&i.package.name&&i.package.version?`customized engine in ${i.package.name} v${i.package.version}`:"customized engine",console.log(`${name} v${version$1}${t?` (w/ ${t})`:""}`),0}))}var OptionGroup;!function(e){e.Basic="Basic Options:",e.Converter="Converter Options:",e.Template="Template Options:",e.Meta="Meta Options:",e.Marp="Marp / Marpit Options:"}(OptionGroup||(OptionGroup={}));const usage="\nUsage:\n  marp [options] <files...>\n  marp [options] -I <dir>\n".trim();function marpCli(e=[]){return __awaiter(this,void 0,void 0,(function*(){let t;try{const i=yargs(e).usage(usage).help(!1).version(!1).options({version:{alias:"v",describe:"Show versions",group:OptionGroup.Basic,type:"boolean"},help:{alias:"h",describe:"Show help",group:OptionGroup.Basic,type:"boolean"},output:{alias:"o",describe:"Output file path (or directory when input-dir is passed)",group:OptionGroup.Basic,type:"string"},"input-dir":{alias:"I",describe:"The base directory to find markdown and theme CSS",group:OptionGroup.Basic,type:"string"},"config-file":{alias:"c",describe:"Specify path to configuration file",group:OptionGroup.Basic,type:"string"},watch:{alias:"w",describe:"Watch input markdowns for changes",group:OptionGroup.Basic,type:"boolean"},server:{alias:"s",describe:"Enable server mode",group:OptionGroup.Basic,type:"boolean"},preview:{alias:"p",describe:"Open preview window (EXPERIMENTAL)",hidden:!!process.env.IS_DOCKER,group:OptionGroup.Basic,type:"boolean"},stdin:{default:!0,describe:"Read Markdown from stdin",hidden:!0,group:OptionGroup.Basic,type:"boolean"},pdf:{conflicts:["image","images","pptx"],describe:"Convert slide deck into PDF",group:OptionGroup.Converter,type:"boolean"},pptx:{conflicts:["pdf","image","images"],describe:"Convert slide deck into PowerPoint document",group:OptionGroup.Converter,type:"boolean"},image:{conflicts:["pdf","images","pptx"],describe:"Convert the first slide page into an image file",group:OptionGroup.Converter,choices:["png","jpeg"],coerce:e=>"jpg"===e?"jpeg":e,type:"string"},images:{conflicts:["pdf","image","pptx"],describe:"Convert slide deck into multiple image files",group:OptionGroup.Converter,choices:["png","jpeg"],coerce:e=>"jpg"===e?"jpeg":e,type:"string"},"jpeg-quality":{defaultDescription:"85",describe:"Setting JPEG image quality",group:OptionGroup.Converter,type:"number"},"allow-local-files":{describe:"Allow to access local files from Markdown while converting PDF and image (NOT SECURE)",group:OptionGroup.Converter,type:"boolean"},template:{describe:"Choose template",defaultDescription:"bespoke",group:OptionGroup.Template,choices:Object.keys(templates),type:"string"},"bespoke.osc":{describe:"[Bespoke] Use on-screen controller",defaultDescription:"true",group:OptionGroup.Template,type:"boolean"},"bespoke-osc":{coerce:e=>(warn(`${chalk.yellow("--bespoke-osc")} option is deprecated. Please use ${chalk.yellow("--bespoke.osc")} instead.`),e),describe:"[DEPRECATED]",group:OptionGroup.Template,hidden:!0,type:"boolean"},"bespoke.progress":{describe:"[Bespoke] Use progress bar",defaultDescription:"false",group:OptionGroup.Template,type:"boolean"},"bespoke-progress":{coerce:e=>(warn(`${chalk.yellow("--bespoke-progress")} option is deprecated. Please use ${chalk.yellow("--bespoke.progress")} instead.`),e),describe:"[DEPRECATED]",group:OptionGroup.Template,hidden:!0,type:"boolean"},title:{describe:"Define title of the slide deck",group:OptionGroup.Meta,type:"string"},description:{describe:"Define description of the slide deck",group:OptionGroup.Meta,type:"string"},url:{describe:"Define canonical URL",group:OptionGroup.Meta,type:"string"},"og-image":{describe:"Define Open Graph image URL",group:OptionGroup.Meta,type:"string"},engine:{describe:"Select Marpit based engine by module name or path",group:OptionGroup.Marp,type:"string"},html:{describe:"Enable or disable HTML tag",group:OptionGroup.Marp,type:"boolean"},theme:{describe:"Override theme by name or CSS file",group:OptionGroup.Marp,type:"string"},"theme-set":{array:!0,describe:"Path to additional theme CSS files",group:OptionGroup.Marp,type:"string"}}),r=i.argv;if(r.help)return i.showHelp(),0;const n=yield fromArguments(r);if(r.version)return yield outputVersion(n);const o=new Converter(yield n.converterOption()),s=o.options,a=()=>__awaiter(this,void 0,void 0,(function*(){if(s.inputDir)return n.files.length>0?(error("Cannot pass files together with input directory."),[]):File.findDir(s.inputDir);return[r.stdin?yield File.stdin():void 0,...yield File.find(...n.files)].filter(e=>e)})),p=yield a(),{length:l}=p;if(0===l)return n.files.length>0&&warn("Not found processable Markdown file(s).\n"),i.showHelp(),n.files.length>0?1:0;const c=[],d=e=>{const{file:t,newFile:i}=e;if(!i)return;const r=(e,t)=>e.type===FileType.StandardIO?t:e.relativePath();c.push(i),info(`${r(t,"<stdin>")} ${i.type===FileType.Null?"processed.":`=> ${r(i,"<stdout>")}`}`,{singleLine:!0})};try{s.server?yield o.convertFiles(p,{onlyScanning:!0}):(info(`Converting ${l} markdown${l>1?"s":""}...`),yield o.convertFiles(p,{onConverted:d}))}catch(e){error$1(`Failed converting Markdown. (${e.message})`,e.errorCode)}if(s.watch){t=watcher([...s.inputDir?[s.inputDir]:n.files,...s.themeSet.fnForWatch],{converter:o,finder:a,events:{onConverted:d,onError:e=>error(`Failed converting Markdown. (${e.message})`)},mode:s.server?Watcher.WatchMode.Notify:Watcher.WatchMode.Convert});const e=new Preview;if(e.on("exit",()=>process.exit()),e.on("opening",e=>{const t=`[Preview] (EXPERIMENTAL) Opening ${e.substr(0,50)}...`;info(chalk.cyan(t))}),s.server){const t=new Server(o,{directoryIndex:["index.md","PITCHME.md"]});t.on("converted",d),t.on("error",e=>error(e.toString())),yield t.start();const i=`http://localhost:${t.port}`,r=`[Server mode] Start server listened at ${i}/ ...`;info(chalk.green(r)),s.preview&&(yield e.open(i))}else if(info(chalk.green("[Watch mode] Start watching...")),s.preview)for(const t of c)s.type!==ConvertType.pptx&&(yield e.open(fileToURI(t,s.type)))}return 0}catch(e){if(!(e instanceof CLIError))throw e;return error(e.message),notifier.stop(),t&&t.chokidar.close(),e.errorCode}finally{yield Converter.closeBrowser()}}))}exports.default=marpCli;
